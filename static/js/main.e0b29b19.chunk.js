(this["webpackJsonpdungeon-crawler"]=this["webpackJsonpdungeon-crawler"]||[]).push([[0],{16:function(e,t,a){e.exports=a(32)},21:function(e,t,a){},22:function(e,t,a){},28:function(e,t,a){},29:function(e,t,a){},30:function(e,t,a){},31:function(e,t,a){},32:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(9),i=a.n(o),l=(a(21),a(2)),c=(a(22),a(10)),s=a(1),p=a(4),u=a(6),h=a(5),d=a(7),y=(a(28),function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(u.a)(this,Object(h.a)(t).call(this,e))).handleKeyDown=function(e){!a.props.movementEnabled||"ArrowLeft"!=e.key&&"ArrowUp"!=e.key&&"ArrowDown"!=e.key&&"ArrowRight"!=e.key||(a.props.dispatch({type:"KEYDOWN",key:e.key,id:"player"}),setTimeout((function(){return a.props.dispatch({type:"ENEMYTURN"})}),100))},a.handleSquareClick=function(e){null!=e&&a.props.dispatch({type:"SHOWINFO",id:e})},a.mapRef=r.a.createRef(),a}return Object(d.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){this.mapRef.current.focus()}},{key:"render",value:function(){for(var e=this,t=[],a={height:this.props.squareSize+"px",width:this.props.squareSize+"px"},n=0;n<this.props.shownMap.length;n++)for(var o=function(o){var i=e.props.shownMap[n][o],l=void 0;i.hasOwnProperty("occupied")?(l="player"==i.occupied?"player":e.props.enemies[i.occupied].type,t.push(r.a.createElement(m,{type:l,style:a,key:n+" "+o,onClick:function(){return e.handleSquareClick(i.occupied)}}))):(l=i.type,t.push(r.a.createElement(m,{type:l,style:a,key:n+" "+o})))},i=0;i<this.props.shownMap[n].length;i++)o(i);var l={gridTemplateColumns:"repeat("+this.props.shownMap[0].length+", "+this.props.squareSize+"px)",width:this.props.shownMap[0].length*this.props.squareSize+"px",height:this.props.shownMap.length*this.props.squareSize+"px"};return r.a.createElement("div",{className:"map",style:l,tabIndex:"0",onKeyDown:this.handleKeyDown,ref:this.mapRef},t)}}]),t}(r.a.Component)),m=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(u.a)(this,Object(h.a)(t).call(this,e))).state={type:a.props.type},a}return Object(d.a)(t,e),Object(p.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({type:e.type})}},{key:"render",value:function(){var e=this.props.style;switch(e={height:this.props.style.height},this.state.type){case"ground":e.background="#9c7711";break;case"grass":e.background="#7ec850";break;case"rock":e.background="#5c4e29";break;case"player":e.background="#4287f5";break;case"ghoul":e.background="#6e3434";break;case"automaton":e.background="#b51616";break;case"dryad":e.background="#214a26";break;default:e.background="#000000"}return r.a.createElement("div",{className:"square",style:e,onClick:this.props.onClick})}}]),t}(r.a.Component),v=Object(s.b)((function(e){return{squareSize:e.squareSize,shownMap:e.shownMap,enemies:e.maps[e.currentMapId].enemies,movementEnabled:e.movementEnabled}}))(y),f=(a(29),function(e){var t=[],a="Portraits/".concat(e.type,".gif"),n="player"==e.type;n&&t.push(r.a.createElement(g,{value:e.entity.exp,maxValue:100*e.entity.lvl,barType:"Exp",entityType:"player"}));Math.floor(e.entity.health/e.entity.maxHealth*100);t.push(r.a.createElement(g,{value:e.entity.health,maxValue:e.entity.maxHealth,barType:"HP",entityType:n?"player":"enemy"}));var o=null;return n||(o=r.a.createElement("h1",null,e.type[0].toUpperCase()+e.type.slice(1))),r.a.createElement("div",{className:"info "+e.group},r.a.createElement("img",{className:"icon",src:a}),o,t,r.a.createElement("h2",null,"Atk:",e.entity.atk),r.a.createElement("h2",null,"Def:",e.entity.def))}),g=function(e){var t="".concat(e.value/e.maxValue*100,"%");return r.a.createElement("div",{className:"bar ".concat(e.entityType+e.barType)},r.a.createElement("div",{className:"barValue"},r.a.createElement("h2",null,"".concat(e.barType,": ").concat(e.value))),r.a.createElement("span",{style:{width:t}}))},w=Object(s.b)((function(e){return"player"==e.shownInfoId||null==e.shownInfoId||"dead"==e.maps[e.currentMapId].enemies[e.shownInfoId]?{player:e.player}:{player:e.player,enemy:e.maps[e.currentMapId].enemies[e.shownInfoId]}}))((function(e){return null==e.enemy?r.a.createElement("div",{className:"infoContainer"},r.a.createElement(f,{entity:e.player,type:"player",group:"player"})):r.a.createElement("div",{className:"infoContainer"},r.a.createElement(f,{entity:e.player,type:"player",group:"player"}),r.a.createElement(f,{entity:e.enemy,type:e.enemy.type,group:"enemy"}))})),x=(a(30),function(e){function t(e){return Object(l.a)(this,t),Object(u.a)(this,Object(h.a)(t).call(this,e))}return Object(d.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"EndScreen",style:"playing"!==this.props.gameState?{"z-index":"100",opacity:"1"}:{"z-index":"-1",opacity:"0"}},r.a.createElement("h1",null,this.props.gameState))}}]),t}(r.a.Component)),b=Object(s.b)((function(e){return{gameState:e.gameState}}))(x),k=(a(31),function(e){function t(e){return Object(l.a)(this,t),Object(u.a)(this,Object(h.a)(t).call(this,e))}return Object(d.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"Tutorial"},r.a.createElement("div",null,r.a.createElement("div",{className:"imgContainer"},r.a.createElement("img",{src:"Icons/arrows-icon.png"})),r.a.createElement("p",null,"Use the arrow keys to move")),r.a.createElement("div",null,r.a.createElement("div",{className:"imgContainer"},r.a.createElement("img",{src:"Icons/mouse-icon.png"})),r.a.createElement("p",null,"Click on enemies to show their stats")))}}]),t}(r.a.Component)),E=Object(s.b)((function(e){return{gameState:e.gameState}}))(k),M=function(e,t,a,n){var r=JSON.parse(JSON.stringify(e));r[a.y][a.x].prev="end";for(var o=[a],i=function(e){var t=[];t.push(r[e.y][e.x].prev);for(var a=0,o=e.x,i=e.y;"end"!==r[i][o].prev&&a<n;){switch(t[t.length-1]){case"ArrowDown":i++;break;case"ArrowLeft":o--;break;case"ArrowUp":i--;break;case"ArrowRight":o++}a++,t.push(r[i][o].prev)}if(a>n)throw"Path is longer than max distance";return t},l=0;l<n;l++){for(var c=[],s=0;s<o.length;s++){var p=o[s];if(p.y+1==t.y&&p.x==t.x)return r[p.y+1][p.x].prev="ArrowUp",i(t);if(p.y-1==t.y&&p.x==t.x)return r[p.y-1][p.x].prev="ArrowDown",i(t);if(p.y==t.y&&p.x+1==t.x)return r[p.y][p.x+1].prev="ArrowLeft",i(t);if(p.y==t.y&&p.x-1==t.x)return r[p.y][p.x-1].prev="ArrowRight",i(t);p.y+1<r.length&&!r[p.y+1][p.x].hasOwnProperty("prev")&&r[p.y+1][p.x].canMoveThrough&&!r[p.y+1][p.x].hasOwnProperty("occupied")&&(r[p.y+1][p.x].prev="ArrowUp",c.push({y:p.y+1,x:p.x})),p.y-1>=0&&!r[p.y-1][p.x].hasOwnProperty("prev")&&r[p.y-1][p.x].canMoveThrough&&!r[p.y-1][p.x].hasOwnProperty("occupied")&&(r[p.y-1][p.x].prev="ArrowDown",c.push({y:p.y-1,x:p.x})),p.x+1<r[0].length&&!r[p.y][p.x+1].hasOwnProperty("prev")&&r[p.y][p.x+1].canMoveThrough&&!r[p.y][p.x+1].hasOwnProperty("occupied")&&(r[p.y][p.x+1].prev="ArrowLeft",c.push({y:p.y,x:p.x+1})),p.x-1>=0&&!r[p.y][p.x-1].hasOwnProperty("prev")&&r[p.y][p.x-1].canMoveThrough&&!r[p.y][p.x-1].hasOwnProperty("occupied")&&(r[p.y][p.x-1].prev="ArrowRight",c.push({y:p.y,x:p.x-1}))}o=c}return!1},O=function e(t){switch(Object(l.a)(this,e),this.type=t,t){case"grass":case"ground":this.canMoveThrough=!0;break;case"rock":this.canMoveThrough=!1;break;default:throw t+" is not a valid terrain type"}},S=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,a=[],n=0;n<e;n++){for(var r=[],o=0;o<t;o++)r.push(new O("grass"));a.push(r)}for(var i=function n(r,o){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,l=function(n,r,o){return!(n<0||r<0||n>=e||r>=t)&&("grass"===a[n][r].type&&Math.floor(100*Math.random())<o&&(a[n][r]=new O("rock"),!0))},c=i-30;l(r-1,o,i)&&n(r-1,o,c),l(r+1,o,i)&&n(r+1,o,c),l(r,o-1,i)&&n(r,o-1,c),l(r,o+1,i)&&n(r,o+1,c)},l=0;l<e;l++)for(var c=0;c<t;c++)0===Math.floor(40*Math.random())&&(a[l][c]=new O("rock"),i(l,c));return a},I=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"valley",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,n=arguments.length>3?arguments[3]:void 0,r={automaton:{maxHealth:150,health:150,atk:11,def:4,expBounty:60},ghoul:{maxHealth:100,health:100,atk:12,def:2,expBounty:70},dryad:{maxHealth:70,health:70,atk:14,def:0,expBounty:80}},o=new Object;switch(e){case"valley":o.land=S(t,a);break;default:throw e+" is not a valid land type"}o.enemies=[];for(var i=0;i<n.length;i++)for(var l=function(e){var t={maxHealth:r[n[i].type].maxHealth,health:r[n[i].type].health,atk:r[n[i].type].atk,def:r[n[i].type].def,expBounty:r[n[i].type].expBounty,type:n[i].type,id:o.enemies.length,coords:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a={x:Math.floor(Math.random()*o.land[0].length),y:Math.floor(Math.random()*o.land.length)};if(o.land[a.y][a.x].canMoveThrough&&!o.land[a.y][a.x].hasOwnProperty("occupied"))return a;if(t<100)return e(t+1);throw"could not generate coordinates"}()};o.enemies.push(t),o.land[t.coords.y][t.coords.x].occupied=t.id},c=0;c<n[i].quantity;c++)l(c);return o},R=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a={left:e.player.coords.x-e.viewRange,top:e.player.coords.y-e.viewRange,right:e.player.coords.x+e.viewRange,bottom:e.player.coords.y+e.viewRange},n=e.maps[t].land[0].length,r=e.maps[t].land.length;n>2*e.viewRange+1?(a.left<0&&(a.right=2*e.viewRange,a.left=0),a.right>n-1&&(a.right=n-1,a.left=a.right-2*e.viewRange)):(a.left=0,a.right=n-1),r>2*e.viewRange+1?(a.top<0&&(a.bottom=2*e.viewRange,a.top=0),a.bottom>r-1&&(a.bottom=r-1,a.top=a.bottom-2*e.viewRange)):(a.top=0,a.bottom=r-1);for(var o=[],i=a.top;i<=a.bottom;i++){for(var l=[],c=a.left;c<=a.right;c++){var s=e.maps[t].land[i][c];l.push(s)}o.push(l)}return o},j=function(){for(var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30,n=!1,r=function(){var r={exp:0,lvl:1,maxHealth:100,health:100,atk:10,def:10,id:"player"},o=I("valley",a,t,[{quantity:7,type:"automaton"},{quantity:6,type:"ghoul"},{quantity:5,type:"dryad"}]);r.coords=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a={x:Math.floor(Math.random()*o.land[0].length),y:Math.floor(Math.random()*o.land.length)};if(o.land[a.y][a.x].canMoveThrough&&!o.land[a.y][a.x].hasOwnProperty("occupied"))return a;if(t<50)return e(t+1);throw"could not generate coordinates"}();for(var i=0;i<o.enemies.length&&!1!==(n=M(o.land,r.coords,o.enemies[i].coords,a*t/2));i++);e={gameState:"playing",maps:[o],squareSize:40,viewRange:5,currentMapId:0,shownInfoId:null,player:r,movementEnabled:!0}};!n;)r();return e.maps[0].land[e.player.coords.y][e.player.coords.x].occupied="player",e.shownMap=R(e),e};var N=Object(c.b)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j(),t=arguments.length>1?arguments[1]:void 0,a=function(e,t,a,n){var r=t.coords.x,o=t.coords.y;if(!n&&"player"===!t.id)throw new Error("moveEntity needs a newPlayer argument if entity is not the player");switch(a){case"ArrowLeft":if(r<=0)return"playing";r--;break;case"ArrowUp":if(o<=0)return"playing";o--;break;case"ArrowRight":if(r>=e.land[0].length-1)return"playing";r++;break;case"ArrowDown":if(o>=e.land.length-1)return"playing";o++;break;default:return"playing"}if(!e.land[o][r].canMoveThrough)return"playing";if(e.land[o][r].hasOwnProperty("occupied")){var i,l=e.land[o][r].occupied,c=function(e,t){var a=e.health,n=t.health,r=e.atk-t.def;r<0&&(r=0);var o=t.atk-e.def;for(o<0&&(o=0);a>0;){if(!((n-=r)>0))return{won:!0,health:a,enemyHealth:0};a-=o}return{won:!1,health:0,enemyHealth:n}}(t,i="player"==l?n:e.enemies[l]);if(!c.won&&"player"==t.id||c.won&&"player"==i.id)return"Game Over";if("player"==t.id){t.health=c.health,t.exp+=e.enemies[i.id].expBounty;for(var s=100*t.lvl;t.exp>s;)t.exp-=s,t.lvl++,t.atk++,t.def++,s+=100;e.enemies[i.id]="dead",e.land[o][r].occupied=e.land[t.coords.y][t.coords.x].occupied,delete e.land[t.coords.y][t.coords.x].occupied,t.coords.x=r,t.coords.y=o}else{i.health=c.enemyHealth,i.exp+=e.enemies[t.id].expBounty;for(var p=100*i.lvl;i.exp>p;)i.exp-=p,i.lvl++,i.atk++,i.def++,p+=100;e.enemies[t.id]="dead",delete e.land[t.coords.y][t.coords.x].occupied}var u=!0,h=!1,d=void 0;try{for(var y,m=e.enemies[Symbol.iterator]();!(u=(y=m.next()).done);u=!0){if("dead"!==y.value)return"playing"}}catch(v){h=!0,d=v}finally{try{u||null==m.return||m.return()}finally{if(h)throw d}}return"Victory"}return e.land[o][r].occupied=e.land[t.coords.y][t.coords.x].occupied,delete e.land[t.coords.y][t.coords.x].occupied,t.coords.x=r,t.coords.y=o,"playing"};switch(t.type){case"KEYDOWN":if("playing"!==e.gameState)return e;e.gameState;var n=JSON.parse(JSON.stringify(e.maps)),r=n[e.currentMapId],o=Object.assign({},e.player),i={gameState:a(r,o,t.key),maps:n,squareSize:e.squareSize,viewRange:e.viewRange,currentMapId:e.currentMapId,player:o,shownInfoId:e.shownInfoId,movementEnabled:!1};return i.shownMap=R(i),i;case"ENEMYTURN":if("playing"!==e.gameState)return e;var l=e.gameState,c=JSON.parse(JSON.stringify(e.maps)),s=c[e.currentMapId],p=Object.assign({},e.player);s.enemies.forEach((function(e){if("dead"!==e){var t=M(s.land,e.coords,p.coords,5);t&&(l=a(s,e,t[0],p))}}));var u={gameState:l,maps:c,squareSize:e.squareSize,viewRange:e.viewRange,currentMapId:e.currentMapId,player:p,shownInfoId:e.shownInfoId,movementEnabled:!0};return u.shownMap=R(u),u;case"SHOWINFO":return{gameState:e.gameState,maps:e.maps,squareSize:e.squareSize,viewRange:e.viewRange,currentMapId:e.currentMapId,player:e.player,shownMap:e.shownMap,shownInfoId:t.id,movementEnabled:e.movementEnabled};case"":return{gameState:e.gameState,maps:e.maps,squareSize:e.squareSize,viewRange:e.viewRange,currentMapId:e.currentMapId,player:e.player,shownMap:e.shownMap,shownInfoId:e.shownInfoId,movementEnabled:e.movementEnabled};default:return e}return e})),q=function(){return r.a.createElement(s.a,{store:N},r.a.createElement("div",{className:"App"},r.a.createElement(b,null),r.a.createElement(w,null),r.a.createElement(v,null),r.a.createElement(E,null)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(q,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[16,1,2]]]);
//# sourceMappingURL=main.e0b29b19.chunk.js.map