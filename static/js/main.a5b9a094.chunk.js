(this["webpackJsonpdungeon-crawler"]=this["webpackJsonpdungeon-crawler"]||[]).push([[0],{16:function(e,a,t){e.exports=t(31)},21:function(e,a,t){},22:function(e,a,t){},28:function(e,a,t){},29:function(e,a,t){},30:function(e,a,t){},31:function(e,a,t){"use strict";t.r(a);var r=t(0),n=t.n(r),o=t(9),i=t.n(o),l=(t(21),t(3)),p=(t(22),t(10)),s=t(1),c=t(5),h=t(7),u=t(6),d=t(8),y=(t(28),function(e){function a(e){var t;return Object(l.a)(this,a),(t=Object(h.a)(this,Object(u.a)(a).call(this,e))).handleKeyDown=function(e){!t.props.movementEnabled||"ArrowLeft"!=e.key&&"ArrowUp"!=e.key&&"ArrowDown"!=e.key&&"ArrowRight"!=e.key||(t.props.dispatch({type:"KEYDOWN",key:e.key,id:"player"}),setTimeout((function(){return t.props.dispatch({type:"ENEMYTURN"})}),100))},t.handleSquareClick=function(e){null!=e&&t.props.dispatch({type:"SHOWINFO",id:e})},t.mapRef=n.a.createRef(),t}return Object(d.a)(a,e),Object(c.a)(a,[{key:"componentDidMount",value:function(){this.mapRef.current.focus()}},{key:"render",value:function(){for(var e=this,a=[],t={height:this.props.squareSize+"px",width:this.props.squareSize+"px"},r=0;r<this.props.shownMap.length;r++)for(var o=function(o){var i=e.props.shownMap[r][o],l=void 0;i.hasOwnProperty("occupied")?(l="player"==i.occupied?"player":e.props.enemies[i.occupied].type,a.push(n.a.createElement(m,{type:l,style:t,key:r+" "+o,onClick:function(){return e.handleSquareClick(i.occupied)}}))):(l=i.type,a.push(n.a.createElement(m,{type:l,style:t,key:r+" "+o})))},i=0;i<this.props.shownMap[r].length;i++)o(i);var l={gridTemplateColumns:"repeat("+this.props.shownMap[0].length+", "+this.props.squareSize+"px)",width:this.props.shownMap[0].length*this.props.squareSize+"px",height:this.props.shownMap.length*this.props.squareSize+"px"};return n.a.createElement("div",{className:"map",style:l,tabIndex:"0",onKeyDown:this.handleKeyDown,ref:this.mapRef},a)}}]),a}(n.a.Component)),m=function(e){function a(e){var t;return Object(l.a)(this,a),(t=Object(h.a)(this,Object(u.a)(a).call(this,e))).state={type:t.props.type},t}return Object(d.a)(a,e),Object(c.a)(a,[{key:"componentWillReceiveProps",value:function(e){this.setState({type:e.type})}},{key:"render",value:function(){var e=this.props.style;switch(e={height:this.props.style.height},this.state.type){case"ground":e.background="#9c7711";break;case"grass":e.background="#7ec850";break;case"rock":e.background="#5c4e29";break;case"player":e.background="#4287f5";break;case"ghoul":e.background="#6e3434";break;case"automaton":e.background="#b51616";break;case"dryad":e.background="#214a26";break;default:e.background="#000000"}return n.a.createElement("div",{className:"square",style:e,onClick:this.props.onClick})}}]),a}(n.a.Component),f=Object(s.b)((function(e){return{squareSize:e.squareSize,shownMap:e.shownMap,enemies:e.maps[e.currentMapId].enemies,movementEnabled:e.movementEnabled}}))(y),v=(t(29),function(e){var a=[],t="Portraits/".concat(e.type,".gif"),r="player"==e.type;r&&a.push(n.a.createElement(g,{value:e.entity.exp,maxValue:100*e.entity.lvl,barType:"Exp",entityType:"player"}));Math.floor(e.entity.health/e.entity.maxHealth*100);return a.push(n.a.createElement(g,{value:e.entity.health,maxValue:e.entity.maxHealth,barType:"HP",entityType:r?"player":"enemy"})),n.a.createElement("div",{className:"info "+e.group},n.a.createElement("img",{className:"icon",src:t}),a,n.a.createElement("h2",null,"Atk:",e.entity.atk),n.a.createElement("h2",null,"Def:",e.entity.def))}),g=function(e){var a="".concat(e.value/e.maxValue*100,"%");return n.a.createElement("div",{className:"bar ".concat(e.entityType+e.barType)},n.a.createElement("div",{className:"barValue"},n.a.createElement("h2",null,"".concat(e.barType,": ").concat(e.value))),n.a.createElement("span",{style:{width:a}}))},w=Object(s.b)((function(e){return"player"==e.shownInfoId||null==e.shownInfoId||"dead"==e.maps[e.currentMapId].enemies[e.shownInfoId]?{player:e.player}:{player:e.player,enemy:e.maps[e.currentMapId].enemies[e.shownInfoId]}}))((function(e){return null==e.enemy?n.a.createElement("div",{className:"infoContainer"},n.a.createElement(v,{entity:e.player,type:"player",group:"player"})):n.a.createElement("div",{className:"infoContainer"},n.a.createElement(v,{entity:e.player,type:"player",group:"player"}),n.a.createElement(v,{entity:e.enemy,type:e.enemy.type,group:"enemy"}))})),x=(t(30),function(e){function a(e){return Object(l.a)(this,a),Object(h.a)(this,Object(u.a)(a).call(this,e))}return Object(d.a)(a,e),Object(c.a)(a,[{key:"render",value:function(){return n.a.createElement("div",{className:"EndScreen",style:"playing"!==this.props.gameState?{"z-index":"100",opacity:"1"}:{"z-index":"-1",opacity:"0"}},n.a.createElement("h1",null,this.props.gameState))}}]),a}(n.a.Component)),b=Object(s.b)((function(e){return{gameState:e.gameState}}))(x),k=function(e,a,t,r){var n=JSON.parse(JSON.stringify(e));n[t.y][t.x].prev="end";for(var o=[t],i=function(e){var a=[];a.push(n[e.y][e.x].prev);for(var t=0,o=e.x,i=e.y;"end"!==n[i][o].prev&&t<r;){switch(a[a.length-1]){case"ArrowDown":i++;break;case"ArrowLeft":o--;break;case"ArrowUp":i--;break;case"ArrowRight":o++}t++,a.push(n[i][o].prev)}if(t>r)throw"Path is longer than max distance";return a},l=0;l<r;l++){for(var p=[],s=0;s<o.length;s++){var c=o[s];if(c.y+1==a.y&&c.x==a.x)return n[c.y+1][c.x].prev="ArrowUp",i(a);if(c.y-1==a.y&&c.x==a.x)return n[c.y-1][c.x].prev="ArrowDown",i(a);if(c.y==a.y&&c.x+1==a.x)return n[c.y][c.x+1].prev="ArrowLeft",i(a);if(c.y==a.y&&c.x-1==a.x)return n[c.y][c.x-1].prev="ArrowRight",i(a);c.y+1<n.length&&!n[c.y+1][c.x].hasOwnProperty("prev")&&n[c.y+1][c.x].canMoveThrough&&!n[c.y+1][c.x].hasOwnProperty("occupied")&&(n[c.y+1][c.x].prev="ArrowUp",p.push({y:c.y+1,x:c.x})),c.y-1>=0&&!n[c.y-1][c.x].hasOwnProperty("prev")&&n[c.y-1][c.x].canMoveThrough&&!n[c.y-1][c.x].hasOwnProperty("occupied")&&(n[c.y-1][c.x].prev="ArrowDown",p.push({y:c.y-1,x:c.x})),c.x+1<n[0].length&&!n[c.y][c.x+1].hasOwnProperty("prev")&&n[c.y][c.x+1].canMoveThrough&&!n[c.y][c.x+1].hasOwnProperty("occupied")&&(n[c.y][c.x+1].prev="ArrowLeft",p.push({y:c.y,x:c.x+1})),c.x-1>=0&&!n[c.y][c.x-1].hasOwnProperty("prev")&&n[c.y][c.x-1].canMoveThrough&&!n[c.y][c.x-1].hasOwnProperty("occupied")&&(n[c.y][c.x-1].prev="ArrowRight",p.push({y:c.y,x:c.x-1}))}o=p}return!1},M=function e(a){switch(Object(l.a)(this,e),this.type=a,a){case"grass":case"ground":this.canMoveThrough=!0;break;case"rock":this.canMoveThrough=!1;break;default:throw a+" is not a valid terrain type"}},E=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,t=[],r=0;r<e;r++){for(var n=[],o=0;o<a;o++)n.push(new M("grass"));t.push(n)}for(var i=function r(n,o){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,l=function(r,n,o){return!(r<0||n<0||r>=e||n>=a)&&("grass"===t[r][n].type&&Math.floor(100*Math.random())<o&&(t[r][n]=new M("rock"),!0))},p=i-30;l(n-1,o,i)&&r(n-1,o,p),l(n+1,o,i)&&r(n+1,o,p),l(n,o-1,i)&&r(n,o-1,p),l(n,o+1,i)&&r(n,o+1,p)},l=0;l<e;l++)for(var p=0;p<a;p++)0===Math.floor(40*Math.random())&&(t[l][p]=new M("rock"),i(l,p));return t},O=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"valley",a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,r=arguments.length>3?arguments[3]:void 0,n={automaton:{maxHealth:150,health:150,atk:11,def:4,expBounty:60},ghoul:{maxHealth:100,health:100,atk:12,def:2,expBounty:70},dryad:{maxHealth:70,health:70,atk:14,def:0,expBounty:80}},o=new Object;switch(e){case"valley":o.land=E(a,t);break;default:throw e+" is not a valid land type"}o.enemies=[];for(var i=0;i<r.length;i++)for(var l=function(e){var a={maxHealth:n[r[i].type].maxHealth,health:n[r[i].type].health,atk:n[r[i].type].atk,def:n[r[i].type].def,expBounty:n[r[i].type].expBounty,type:r[i].type,id:o.enemies.length,coords:function e(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t={x:Math.floor(Math.random()*o.land[0].length),y:Math.floor(Math.random()*o.land.length)};if(o.land[t.y][t.x].canMoveThrough&&!o.land[t.y][t.x].hasOwnProperty("occupied"))return t;if(a<100)return e(a+1);throw"could not generate coordinates"}()};o.enemies.push(a),o.land[a.coords.y][a.coords.x].occupied=a.id},p=0;p<r[i].quantity;p++)l(p);return o},S=function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t={left:e.player.coords.x-e.viewRange,top:e.player.coords.y-e.viewRange,right:e.player.coords.x+e.viewRange,bottom:e.player.coords.y+e.viewRange},r=e.maps[a].land[0].length,n=e.maps[a].land.length;r>2*e.viewRange+1?(t.left<0&&(t.right=2*e.viewRange,t.left=0),t.right>r-1&&(t.right=r-1,t.left=t.right-2*e.viewRange)):(t.left=0,t.right=r-1),n>2*e.viewRange+1?(t.top<0&&(t.bottom=2*e.viewRange,t.top=0),t.bottom>n-1&&(t.bottom=n-1,t.top=t.bottom-2*e.viewRange)):(t.top=0,t.bottom=n-1);for(var o=[],i=t.top;i<=t.bottom;i++){for(var l=[],p=t.left;p<=t.right;p++){var s=e.maps[a].land[i][p];l.push(s)}o.push(l)}return o},I=function(){for(var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30,r=!1,n=function(){var n={exp:0,lvl:1,maxHealth:100,health:100,atk:10,def:10,id:"player"},o=O("valley",t,a,[{quantity:7,type:"automaton"},{quantity:6,type:"ghoul"},{quantity:5,type:"dryad"}]);n.coords=function e(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t={x:Math.floor(Math.random()*o.land[0].length),y:Math.floor(Math.random()*o.land.length)};if(o.land[t.y][t.x].canMoveThrough&&!o.land[t.y][t.x].hasOwnProperty("occupied"))return t;if(a<50)return e(a+1);throw"could not generate coordinates"}();for(var i=0;i<o.enemies.length&&!1!==(r=k(o.land,n.coords,o.enemies[i].coords,t*a/2));i++);e={gameState:"playing",maps:[o],squareSize:40,viewRange:5,currentMapId:0,shownInfoId:null,player:n,movementEnabled:!0}};!r;)n();return e.maps[0].land[e.player.coords.y][e.player.coords.x].occupied="player",e.shownMap=S(e),e};var R=Object(p.b)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I(),a=arguments.length>1?arguments[1]:void 0,t=function(e,a,t,r){var n=a.coords.x,o=a.coords.y;if(!r&&"player"===!a.id)throw new Error("moveEntity needs a newPlayer argument if entity is not the player");switch(t){case"ArrowLeft":if(n<=0)return"playing";n--;break;case"ArrowUp":if(o<=0)return"playing";o--;break;case"ArrowRight":if(n>=e.land[0].length-1)return"playing";n++;break;case"ArrowDown":if(o>=e.land.length-1)return"playing";o++;break;default:return"playing"}if(!e.land[o][n].canMoveThrough)return"playing";if(e.land[o][n].hasOwnProperty("occupied")){var i,l=e.land[o][n].occupied,p=function(e,a){var t=e.health,r=a.health,n=e.atk-a.def;n<0&&(n=0);var o=a.atk-e.def;for(o<0&&(o=0);t>0;){if(!((r-=n)>0))return{won:!0,health:t,enemyHealth:0};t-=o}return{won:!1,health:0,enemyHealth:r}}(a,i="player"==l?r:e.enemies[l]);if(!p.won&&"player"==a.id||p.won&&"player"==i.id)return"Game Over";if("player"==a.id){a.health=p.health,a.exp+=e.enemies[i.id].expBounty;for(var s=100*a.lvl;a.exp>s;)a.exp-=s,a.lvl++,a.atk++,a.def++,s+=100;e.enemies[i.id]="dead",e.land[o][n].occupied=e.land[a.coords.y][a.coords.x].occupied,delete e.land[a.coords.y][a.coords.x].occupied,a.coords.x=n,a.coords.y=o}else{i.health=p.enemyHealth,i.exp+=e.enemies[a.id].expBounty;for(var c=100*i.lvl;i.exp>c;)i.exp-=c,i.lvl++,i.atk++,i.def++,c+=100;e.enemies[a.id]="dead",delete e.land[a.coords.y][a.coords.x].occupied}var h=!0,u=!1,d=void 0;try{for(var y,m=e.enemies[Symbol.iterator]();!(h=(y=m.next()).done);h=!0){if("dead"!==y.value)return"playing"}}catch(f){u=!0,d=f}finally{try{h||null==m.return||m.return()}finally{if(u)throw d}}return"Victory"}return e.land[o][n].occupied=e.land[a.coords.y][a.coords.x].occupied,delete e.land[a.coords.y][a.coords.x].occupied,a.coords.x=n,a.coords.y=o,"playing"};switch(a.type){case"KEYDOWN":if("playing"!==e.gameState)return e;e.gameState;var r=JSON.parse(JSON.stringify(e.maps)),n=r[e.currentMapId],o=Object.assign({},e.player),i={gameState:t(n,o,a.key),maps:r,squareSize:e.squareSize,viewRange:e.viewRange,currentMapId:e.currentMapId,player:o,shownInfoId:e.shownInfoId,movementEnabled:!1};return i.shownMap=S(i),i;case"ENEMYTURN":if("playing"!==e.gameState)return e;var l=e.gameState,p=JSON.parse(JSON.stringify(e.maps)),s=p[e.currentMapId],c=Object.assign({},e.player);s.enemies.forEach((function(e){if("dead"!==e){var a=k(s.land,e.coords,c.coords,5);a&&(l=t(s,e,a[0],c))}}));var h={gameState:l,maps:p,squareSize:e.squareSize,viewRange:e.viewRange,currentMapId:e.currentMapId,player:c,shownInfoId:e.shownInfoId,movementEnabled:!0};return h.shownMap=S(h),h;case"SHOWINFO":return{gameState:e.gameState,maps:e.maps,squareSize:e.squareSize,viewRange:e.viewRange,currentMapId:e.currentMapId,player:e.player,shownMap:e.shownMap,shownInfoId:a.id,movementEnabled:e.movementEnabled};case"":return{gameState:e.gameState,maps:e.maps,squareSize:e.squareSize,viewRange:e.viewRange,currentMapId:e.currentMapId,player:e.player,shownMap:e.shownMap,shownInfoId:e.shownInfoId,movementEnabled:e.movementEnabled};default:return e}return e})),N=function(){return n.a.createElement(s.a,{store:R},n.a.createElement("div",{className:"app"},n.a.createElement(b,null),n.a.createElement(w,null),n.a.createElement(f,null)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(n.a.createElement(N,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[16,1,2]]]);
//# sourceMappingURL=main.a5b9a094.chunk.js.map