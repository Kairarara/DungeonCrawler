(this["webpackJsonpdungeon-crawler"]=this["webpackJsonpdungeon-crawler"]||[]).push([[0],{16:function(e,a,t){e.exports=t(32)},21:function(e,a,t){},22:function(e,a,t){},28:function(e,a,t){},29:function(e,a,t){},30:function(e,a,t){},31:function(e,a,t){},32:function(e,a,t){"use strict";t.r(a);var r=t(0),n=t.n(r),o=t(5),l=t.n(o),i=(t(21),t(22),t(6)),c=t(2),p=t(4),s=t(10),u=t(12),h=t(11),d=t(13),y=(t(28),function(e){function a(e){var t;return Object(p.a)(this,a),(t=Object(u.a)(this,Object(h.a)(a).call(this,e))).handleKeyDown=function(e){!t.props.movementEnabled||"ArrowLeft"!=e.key&&"ArrowUp"!=e.key&&"ArrowDown"!=e.key&&"ArrowRight"!=e.key||(t.props.dispatch({type:"KEYDOWN",key:e.key,id:"player"}),setTimeout((function(){return t.props.dispatch({type:"ENEMYTURN"})}),100))},t.handleSquareClick=function(e){null!=e&&t.props.dispatch({type:"SHOWINFO",id:e})},t.mapRef=n.a.createRef(),t}return Object(d.a)(a,e),Object(s.a)(a,[{key:"componentDidMount",value:function(){this.mapRef.current.focus()}},{key:"render",value:function(){for(var e=this,a=[],t={height:this.props.squareSize+"px",width:this.props.squareSize+"px"},r=0;r<this.props.shownMap.length;r++)for(var o=function(o){var l=e.props.shownMap[r][o],i=void 0;l.hasOwnProperty("occupied")?(i="player"==l.occupied?"player":e.props.enemies[l.occupied].type,a.push(n.a.createElement(m,{type:i,style:t,key:r+" "+o,onClick:function(){return e.handleSquareClick(l.occupied)}}))):(i=l.type,a.push(n.a.createElement(m,{type:i,style:t,key:r+" "+o})))},l=0;l<this.props.shownMap[r].length;l++)o(l);var i={gridTemplateColumns:"repeat("+this.props.shownMap[0].length+", "+this.props.squareSize+"px)",width:this.props.shownMap[0].length*this.props.squareSize+"px",height:this.props.shownMap.length*this.props.squareSize+"px"};return n.a.createElement("div",{className:"map",style:i,tabIndex:"0",onKeyDown:this.handleKeyDown,ref:this.mapRef},a)}}]),a}(n.a.Component)),m=function(e){function a(e){var t;return Object(p.a)(this,a),(t=Object(u.a)(this,Object(h.a)(a).call(this,e))).state={type:t.props.type},t}return Object(d.a)(a,e),Object(s.a)(a,[{key:"componentWillReceiveProps",value:function(e){this.setState({type:e.type})}},{key:"render",value:function(){var e=this.props.style;switch(e={height:this.props.style.height},this.state.type){case"ground":e.background="#9c7711";break;case"grass":e.background="#7ec850";break;case"rock":e.background="#5c4e29";break;case"player":e.background="#4287f5";break;case"ghoul":e.background="#6e3434";break;case"automaton":e.background="#b51616";break;case"dryad":e.background="#214a26";break;default:e.background="#000000"}return n.a.createElement("div",{className:"square",style:e,onClick:this.props.onClick})}}]),a}(n.a.Component),v=Object(c.b)((function(e){return{squareSize:e.squareSize,shownMap:e.shownMap,enemies:e.maps[e.currentMapId].enemies,movementEnabled:e.movementEnabled}}))(y),f=(t(29),function(e){var a=[],t="Portraits/".concat(e.type,".gif"),r="player"==e.type;r&&a.push(n.a.createElement(g,{value:e.entity.exp,maxValue:100*e.entity.lvl,barType:"Exp",entityType:"player"})),a.push(n.a.createElement(g,{value:e.entity.health,maxValue:e.entity.maxHealth,barType:"HP",entityType:r?"player":"enemy"}));var o=null;return r||(o=n.a.createElement("h1",null,e.type[0].toUpperCase()+e.type.slice(1))),n.a.createElement("div",{className:"info "+e.group},n.a.createElement("img",{className:"icon",src:t,alt:o+" portrait"}),o,a,n.a.createElement("h2",null,"Atk:",e.entity.atk),n.a.createElement("h2",null,"Def:",e.entity.def))}),g=function(e){var a="".concat(e.value/e.maxValue*100,"%");return n.a.createElement("div",{className:"bar ".concat(e.entityType+e.barType)},n.a.createElement("div",{className:"barValue"},n.a.createElement("h2",null,"".concat(e.barType,": ").concat(e.value))),n.a.createElement("span",{style:{width:a}}))},w=Object(c.b)((function(e){return"player"==e.shownInfoId||null==e.shownInfoId||"dead"==e.maps[e.currentMapId].enemies[e.shownInfoId]?{player:e.player}:{player:e.player,enemy:e.maps[e.currentMapId].enemies[e.shownInfoId]}}))((function(e){return null==e.enemy?n.a.createElement("div",{className:"infoContainer"},n.a.createElement(f,{entity:e.player,type:"player",group:"player"})):n.a.createElement("div",{className:"infoContainer"},n.a.createElement(f,{entity:e.player,type:"player",group:"player"}),n.a.createElement(f,{entity:e.enemy,type:e.enemy.type,group:"enemy"}))})),x=(t(30),Object(c.b)((function(e){return{gameState:e.gameState}}))((function(e){return n.a.createElement("div",{className:"EndScreen",style:"playing"!==e.gameState?{"z-index":"100",opacity:"1"}:{"z-index":"-1",opacity:"0"}},n.a.createElement("h1",null,e.gameState))}))),b=(t(31),function(e){return n.a.createElement("div",{className:"Tutorial"},n.a.createElement("div",null,n.a.createElement("div",{className:"imgContainer"},n.a.createElement("img",{src:"Icons/arrows-icon.png",alt:"Arrow keys icon"})),n.a.createElement("p",null,"Use the arrow keys to move")),n.a.createElement("div",null,n.a.createElement("div",{className:"imgContainer"},n.a.createElement("img",{src:"Icons/mouse-icon.png",alt:"Mouse icon"})),n.a.createElement("p",null,"Click on enemies to show their stats")))}),E=function e(a){switch(Object(p.a)(this,e),this.type=a,a){case"grass":case"ground":this.canMoveThrough=!0;break;case"rock":this.canMoveThrough=!1;break;default:throw new Error(a+" is not a valid terrain type")}},k=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,t=[],r=0;r<e;r++){for(var n=[],o=0;o<a;o++)n.push(new E("grass"));t.push(n)}for(var l=function r(n,o){var l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,i=function(r,n,o){return!(r<0||n<0||r>=e||n>=a)&&("grass"===t[r][n].type&&Math.floor(100*Math.random())<o&&(t[r][n]=new E("rock"),!0))},c=l-30;i(n-1,o,l)&&r(n-1,o,c),i(n+1,o,l)&&r(n+1,o,c),i(n,o-1,l)&&r(n,o-1,c),i(n,o+1,l)&&r(n,o+1,c)},i=0;i<e;i++)for(var c=0;c<a;c++)0===Math.floor(40*Math.random())&&(t[i][c]=new E("rock"),l(i,c));return t},M=function(e,a,t,r){var n=JSON.parse(JSON.stringify(e));n[t.y][t.x].prev="end";for(var o=[t],l=function(e){var a=[];a.push(n[e.y][e.x].prev);for(var t=0,o=e.x,l=e.y;"end"!==n[l][o].prev&&t<r;){switch(a[a.length-1]){case"ArrowDown":l++;break;case"ArrowLeft":o--;break;case"ArrowUp":l--;break;case"ArrowRight":o++;break;default:throw new Error("Unexpected command stored on path[".concat(a.length-1,"] in getPath functon"))}t++,a.push(n[l][o].prev)}if(t>r)throw new Error("Path is longer than max distance");return a},i=0;i<r;i++){for(var c=[],p=0;p<o.length;p++){var s=o[p];if(s.y+1==a.y&&s.x==a.x)return n[s.y+1][s.x].prev="ArrowUp",l(a);if(s.y-1==a.y&&s.x==a.x)return n[s.y-1][s.x].prev="ArrowDown",l(a);if(s.y==a.y&&s.x+1==a.x)return n[s.y][s.x+1].prev="ArrowLeft",l(a);if(s.y==a.y&&s.x-1==a.x)return n[s.y][s.x-1].prev="ArrowRight",l(a);s.y+1<n.length&&!n[s.y+1][s.x].hasOwnProperty("prev")&&n[s.y+1][s.x].canMoveThrough&&!n[s.y+1][s.x].hasOwnProperty("occupied")&&(n[s.y+1][s.x].prev="ArrowUp",c.push({y:s.y+1,x:s.x})),s.y-1>=0&&!n[s.y-1][s.x].hasOwnProperty("prev")&&n[s.y-1][s.x].canMoveThrough&&!n[s.y-1][s.x].hasOwnProperty("occupied")&&(n[s.y-1][s.x].prev="ArrowDown",c.push({y:s.y-1,x:s.x})),s.x+1<n[0].length&&!n[s.y][s.x+1].hasOwnProperty("prev")&&n[s.y][s.x+1].canMoveThrough&&!n[s.y][s.x+1].hasOwnProperty("occupied")&&(n[s.y][s.x+1].prev="ArrowLeft",c.push({y:s.y,x:s.x+1})),s.x-1>=0&&!n[s.y][s.x-1].hasOwnProperty("prev")&&n[s.y][s.x-1].canMoveThrough&&!n[s.y][s.x-1].hasOwnProperty("occupied")&&(n[s.y][s.x-1].prev="ArrowRight",c.push({y:s.y,x:s.x-1}))}o=c}return!1},I=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"valley",a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,r=arguments.length>3?arguments[3]:void 0,n={automaton:{maxHealth:150,health:150,atk:11,def:4,expBounty:60},ghoul:{maxHealth:100,health:100,atk:12,def:2,expBounty:70},dryad:{maxHealth:70,health:70,atk:14,def:0,expBounty:80}},o=!0,l=!1,i=void 0;try{for(var c,p=r[Symbol.iterator]();!(o=(c=p.next()).done);o=!0){var s=c.value,u=new Image;u.src="Portraits/".concat(s.type,".gif")}}catch(v){l=!0,i=v}finally{try{o||null==p.return||p.return()}finally{if(l)throw i}}var h=new Object;switch(e){case"valley":h.land=k(a,t);break;default:throw new Error(e+" is not a valid land type")}h.enemies=[];for(var d=0;d<r.length;d++)for(var y=function(e){var a={maxHealth:n[r[d].type].maxHealth,health:n[r[d].type].health,atk:n[r[d].type].atk,def:n[r[d].type].def,expBounty:n[r[d].type].expBounty,type:r[d].type,id:h.enemies.length,coords:function e(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t={x:Math.floor(Math.random()*h.land[0].length),y:Math.floor(Math.random()*h.land.length)};if(h.land[t.y][t.x].canMoveThrough&&!h.land[t.y][t.x].hasOwnProperty("occupied"))return t;if(a<100)return e(a+1);throw new Error("could not generate coordinates")}()};h.enemies.push(a),h.land[a.coords.y][a.coords.x].occupied=a.id},m=0;m<r[d].quantity;m++)y(m);return h},S=function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t={left:e.player.coords.x-e.viewRange,top:e.player.coords.y-e.viewRange,right:e.player.coords.x+e.viewRange,bottom:e.player.coords.y+e.viewRange},r=e.maps[a].land[0].length,n=e.maps[a].land.length;r>2*e.viewRange+1?(t.left<0&&(t.right=2*e.viewRange,t.left=0),t.right>r-1&&(t.right=r-1,t.left=t.right-2*e.viewRange)):(t.left=0,t.right=r-1),n>2*e.viewRange+1?(t.top<0&&(t.bottom=2*e.viewRange,t.top=0),t.bottom>n-1&&(t.bottom=n-1,t.top=t.bottom-2*e.viewRange)):(t.top=0,t.bottom=n-1);for(var o=[],l=t.top;l<=t.bottom;l++){for(var i=[],c=t.left;c<=t.right;c++){var p=e.maps[a].land[l][c];i.push(p)}o.push(i)}return o},O=function(){for(var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30,r=!1,n=function(){var n={exp:0,lvl:1,maxHealth:100,health:100,atk:10,def:10,id:"player"},o=I("valley",t,a,[{quantity:7,type:"automaton"},{quantity:6,type:"ghoul"},{quantity:5,type:"dryad"}]);n.coords=function e(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t={x:Math.floor(Math.random()*o.land[0].length),y:Math.floor(Math.random()*o.land.length)};if(o.land[t.y][t.x].canMoveThrough&&!o.land[t.y][t.x].hasOwnProperty("occupied"))return t;if(a<50)return e(a+1);throw new Error("could not generate coordinates")}();for(var l=0;l<o.enemies.length&&!1!==(r=M(o.land,n.coords,o.enemies[l].coords,t*a/2));l++);e={gameState:"playing",maps:[o],squareSize:40,viewRange:5,currentMapId:0,shownInfoId:null,player:n,movementEnabled:!0}};!r;)n();return e.maps[0].land[e.player.coords.y][e.player.coords.x].occupied="player",e.shownMap=S(e),e};var R=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:O(),a=arguments.length>1?arguments[1]:void 0,t=function(e,a,t,r){var n=a.coords.x,o=a.coords.y;if(!r&&"player"===!a.id)throw new Error("moveEntity needs a newPlayer argument if entity is not the player");switch(t){case"ArrowLeft":if(n<=0)return"playing";n--;break;case"ArrowUp":if(o<=0)return"playing";o--;break;case"ArrowRight":if(n>=e.land[0].length-1)return"playing";n++;break;case"ArrowDown":if(o>=e.land.length-1)return"playing";o++;break;default:return"playing"}if(!e.land[o][n].canMoveThrough)return"playing";if(e.land[o][n].hasOwnProperty("occupied")){var l,i=e.land[o][n].occupied,c=function(e,a){var t=e.health,r=a.health,n=e.atk-a.def;n<0&&(n=0);var o=a.atk-e.def;for(o<0&&(o=0);t>0;){if(!((r-=n)>0))return{won:!0,health:t,enemyHealth:0};t-=o}return{won:!1,health:0,enemyHealth:r}}(a,l="player"==i?r:e.enemies[i]);if(!c.won&&"player"==a.id||c.won&&"player"==l.id)return"Game Over";if("player"==a.id){a.health=c.health,a.exp+=e.enemies[l.id].expBounty;for(var p=100*a.lvl;a.exp>p;)a.exp-=p,a.lvl++,a.atk++,a.def++,p+=100;e.enemies[l.id]="dead",e.land[o][n].occupied=e.land[a.coords.y][a.coords.x].occupied,delete e.land[a.coords.y][a.coords.x].occupied,a.coords.x=n,a.coords.y=o}else{l.health=c.enemyHealth,l.exp+=e.enemies[a.id].expBounty;for(var s=100*l.lvl;l.exp>s;)l.exp-=s,l.lvl++,l.atk++,l.def++,s+=100;e.enemies[a.id]="dead",delete e.land[a.coords.y][a.coords.x].occupied}var u=!0,h=!1,d=void 0;try{for(var y,m=e.enemies[Symbol.iterator]();!(u=(y=m.next()).done);u=!0){if("dead"!==y.value)return"playing"}}catch(v){h=!0,d=v}finally{try{u||null==m.return||m.return()}finally{if(h)throw d}}return"Victory"}return e.land[o][n].occupied=e.land[a.coords.y][a.coords.x].occupied,delete e.land[a.coords.y][a.coords.x].occupied,a.coords.x=n,a.coords.y=o,"playing"};switch(a.type){case"KEYDOWN":if("playing"!==e.gameState)return e;e.gameState;var r=JSON.parse(JSON.stringify(e.maps)),n=r[e.currentMapId],o=Object.assign({},e.player),l={gameState:t(n,o,a.key),maps:r,squareSize:e.squareSize,viewRange:e.viewRange,currentMapId:e.currentMapId,player:o,shownInfoId:e.shownInfoId,movementEnabled:!1};return l.shownMap=S(l),l;case"ENEMYTURN":if("playing"!==e.gameState)return e;var i=e.gameState,c=JSON.parse(JSON.stringify(e.maps)),p=c[e.currentMapId],s=Object.assign({},e.player);p.enemies.forEach((function(e){if("dead"!==e){var a=M(p.land,e.coords,s.coords,5);a&&(i=t(p,e,a[0],s))}}));var u={gameState:i,maps:c,squareSize:e.squareSize,viewRange:e.viewRange,currentMapId:e.currentMapId,player:s,shownInfoId:e.shownInfoId,movementEnabled:!0};return u.shownMap=S(u),u;case"SHOWINFO":return{gameState:e.gameState,maps:e.maps,squareSize:e.squareSize,viewRange:e.viewRange,currentMapId:e.currentMapId,player:e.player,shownMap:e.shownMap,shownInfoId:a.id,movementEnabled:e.movementEnabled};case"":return{gameState:e.gameState,maps:e.maps,squareSize:e.squareSize,viewRange:e.viewRange,currentMapId:e.currentMapId,player:e.player,shownMap:e.shownMap,shownInfoId:e.shownInfoId,movementEnabled:e.movementEnabled};default:return e}},N=Object(i.b)(R),q=function(){return n.a.createElement(c.a,{store:N},n.a.createElement("div",{className:"App"},n.a.createElement(x,null),n.a.createElement(w,null),n.a.createElement(v,null),n.a.createElement(b,null)))};l.a.render(n.a.createElement(q,null),document.getElementById("root"))}},[[16,1,2]]]);
//# sourceMappingURL=main.19e55149.chunk.js.map